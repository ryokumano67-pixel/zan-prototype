<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZAN: CLAN WARS Prototype</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Hiragino Mincho ProN', serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        #game-container { position: relative; width: 100%; max-width: 600px; height: 80vh; border: 2px solid #333; overflow: hidden; background: linear-gradient(to bottom, #001, #003); }
        #ui-layer { position: absolute; top: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: none; }
        .character { position: absolute; bottom: 10%; width: 120px; height: 200px; background: #555; transition: transform 0.1s; }
        #player { left: 10%; border-left: 5px solid #0af; }
        #enemy { right: 10%; border-right: 5px solid #f05; }
        #signal { font-size: 80px; color: #f00; display: none; text-shadow: 0 0 20px #f00; font-weight: bold; }
        #result { font-size: 40px; text-align: center; display: none; }
        .flash { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #fff; opacity: 0; pointer-events: none; }
        .zan-text { font-size: 120px; color: #f00; text-shadow: 0 0 30px #ff0; animation: slash 0.3s ease-out; }
        @keyframes slash { 0% { transform: scale(5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        button { padding: 15px 30px; font-size: 20px; background: #c00; color: #fff; border: none; cursor: pointer; pointer-events: auto; }
        #char-select { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 20px; pointer-events: auto; }
        .char-box { width: 60px; height: 60px; background: #333; border: 2px solid #666; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 10px; }
        .char-box:hover { border-color: #f00; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="char-select-screen" style="text-align: center;">
        <h2>SELECT YOUR CLAN</h2>
        <div id="char-select">
            <div class="char-box" onclick="startGame('NINJA A')">NINJA A</div>
            <div class="char-box" onclick="startGame('SAMURAI A')">SAMURAI A</div>
            <div class="char-box" onclick="startGame('GEISHA A')">GEISHA A</div>
            <div class="char-box" onclick="startGame('SHINOBI B')">SHINOBI B</div>
            <div class="char-box" onclick="startGame('SAMURAI B')">SAMURAI B</div>
            <div class="char-box" onclick="startGame('KIMONO B')">KIMONO B</div>
            <div class="char-box" onclick="startGame('MECHA')">MECHA</div>
            <div class="char-box" onclick="startGame('CYBER')">CYBER</div>
        </div>
    </div>

    <div id="battle-screen" style="display:none; width:100%; height:100%;">
        <div id="player" class="character">PLAYER</div>
        <div id="enemy" class="character">CPU</div>
        <div id="ui-layer">
            <div id="signal">斬</div>
            <div id="result">
                <div id="result-text"></div>
                <div id="result-time"></div>
                <br>
                <button onclick="resetGame()">NEXT MATCH</button>
            </div>
        </div>
        <div class="flash" id="flash"></div>
    </div>
</div>

<script>
    let startTime, canZan = false, cpuSpeed = 250; // 0.25秒
    let gameActive = false;

    function startGame(clan) {
        document.getElementById('char-select-screen').style.display = 'none';
        document.getElementById('battle-screen').style.display = 'block';
        resetRound();
    }

    function resetRound() {
        canZan = false;
        gameActive = true;
        document.getElementById('signal').style.display = 'none';
        document.getElementById('result').style.display = 'none';
        
        // 2秒から5秒の間でランダムに合図
        const delay = Math.random() * 3000 + 2000;
        setTimeout(() => {
            if(!gameActive) return;
            showSignal();
        }, delay);
    }

    function showSignal() {
        canZan = true;
        startTime = Date.now();
        document.getElementById('signal').style.display = 'block';
        
        // CPUの反応予約
        setTimeout(() => {
            if(canZan) resolveGame("CPU");
        }, cpuSpeed);
    }

    // 画面クリック時の判定
    document.getElementById('game-container').addEventListener('mousedown', () => {
        if(canZan) {
            resolveGame("PLAYER");
        } else if (gameActive && !document.getElementById('result').style.display.includes('block')) {
            // お手付き
            resolveGame("EARLY");
        }
    });

    function resolveGame(winner) {
        canZan = false;
        gameActive = false;
        const endTime = Date.now();
        const reactionTime = endTime - startTime;
        const flash = document.getElementById('flash');
        
        flash.style.opacity = "1";
        setTimeout(() => flash.style.opacity = "0", 100);

        const resultText = document.getElementById('result-text');
        const resultTime = document.getElementById('result-time');
        
        if(winner === "PLAYER") {
            resultText.innerHTML = "<span class='zan-text'>WIN (斬)</span>";
            resultTime.innerText = "YOUR TIME: " + (reactionTime / 1000).toFixed(3) + "s";
        } else if(winner === "CPU") {
            resultText.innerHTML = "<span style='color:#666'>LOSE (無念)</span>";
            resultTime.innerText = "CPU WAS FASTER (0.250s)";
        } else {
            resultText.innerHTML = "<span style='color:#f0f'>TOO EARLY (早まった)</span>";
            resultTime.innerText = "CALM YOUR MIND";
        }

        document.getElementById('signal').style.display = 'none';
        document.getElementById('result').style.display = 'block';
    }

    function resetGame() {
        document.getElementById('char-select-screen').style.display = 'block';
        document.getElementById('battle-screen').style.display = 'none';
    }
</script>
</body>
</html>
